<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Media Gallery</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dexie/3.2.4/dexie.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="header">
        <h1>üé® AI Media Gallery</h1>
        <p>Store and organize your AI-generated images and videos</p>
    </div>

    <div class="stats">
        <span id="imageCount">0 items stored</span>
    </div>

    <div class="database-info">
        <strong>üìÅ Database Status:</strong> Your media is stored locally in your browser's IndexedDB database.
        <button class="export-btn" id="exportData">Export All Data</button>
        <button class="export-btn" id="importData">Import Data</button>
        <input type="file" id="importFile" accept=".json" style="display: none;">
        <br><small>üí° Tip: Export your data regularly to backup your media collection!</small>
    </div>

    <div class="search-container">
        <input type="text" id="searchBox" class="search-box" placeholder="Search media by title or prompt...">
    </div>

    <div class="upload-area" id="uploadArea">
        <h3>üìÅ Add New Media</h3>
        <p>Drag and drop images or MP4 videos here or click to browse</p>
        <input type="file" id="fileInput" accept="image/*,video/mp4" multiple>
    </div>

    <div class="gallery" id="gallery"></div>

    <div class="no-images" id="noImages" style="display: none;">
        <p>No media yet. Add some images or videos by dragging and dropping them above!</p>
    </div>

    <!-- Modal for viewing/editing images and videos -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            
            <!-- Image display -->
            <img id="modalImage" src="" alt="" style="display: none;">
            
            <!-- Video display -->
            <video id="modalVideo" controls style="display: none;">
                <source src="" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            
            <div class="metadata-form">
                <div class="form-group">
                    <label for="imageTitle">Title:</label>
                    <input type="text" id="imageTitle" placeholder="Enter media title">
                </div>
                <div class="form-group">
                    <label for="imagePrompt">AI Prompt:</label>
                    <textarea id="imagePrompt" placeholder="Enter the AI prompt used to generate this media"></textarea>
                </div>
                <div class="form-group">
                    <label for="imageModel">AI Model:</label>
                    <input type="text" id="imageModel" placeholder="e.g., DALL-E 3, Midjourney, Stable Diffusion, Sora">
                </div>
                <div class="form-group">
                    <label for="imageTags">Tags:</label>
                    <input type="text" id="imageTags" placeholder="Enter tags separated by commas">
                </div>
                <div class="form-group">
                    <label for="imageNotes">Notes:</label>
                    <textarea id="imageNotes" placeholder="Additional notes about this media"></textarea>
                </div>
                
                <!-- Metadata display -->
                <div class="form-group">
                    <label>üìã Media Metadata:</label>
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
                        
                        <!-- Prompt Section -->
                        <div id="promptSection" style="display: none;">
                            <h4 style="color: #2c3e50; margin: 0 0 10px 0; font-size: 14px; font-family: Arial, sans-serif;">
                                üéØ Prompt Data:
                            </h4>
                            <div id="promptDisplay" style="background: #e8f4f8; padding: 8px; border-radius: 4px; margin-bottom: 15px; border-left: 3px solid #3498db;">
                                <em>No prompt data found</em>
                            </div>
                        </div>
                        
                        <!-- Workflow Section -->
                        <div id="workflowSection" style="display: none;">
                            <h4 style="color: #2c3e50; margin: 0 0 10px 0; font-size: 14px; font-family: Arial, sans-serif;">
                                üîß Workflow Data:
                            </h4>
                            <div id="workflowDisplay" style="background: #fff3cd; padding: 8px; border-radius: 4px; margin-bottom: 15px; border-left: 3px solid #ffc107;">
                                <em>No workflow data found</em>
                            </div>
                        </div>
                        
                        <!-- Other Metadata Section -->
                        <div id="otherMetadataSection" style="display: none;">
                            <h4 style="color: #2c3e50; margin: 0 0 10px 0; font-size: 14px; font-family: Arial, sans-serif;">
                                üìÑ Other Metadata:
                            </h4>
                            <div id="otherMetadataDisplay" style="background: #f8f9fa; padding: 8px; border-radius: 4px; border-left: 3px solid #6c757d;">
                                <em>No other metadata found</em>
                            </div>
                        </div>
                        
                        <!-- No metadata message -->
                        <div id="noMetadataMessage" style="text-align: center; color: #6c757d; font-style: italic;">
                            No metadata found
                        </div>
                        
                    </div>
                </div>
                
                <button class="btn" id="saveMetadata">Save Changes</button>
                <button class="btn btn-danger" id="deleteImage">Delete Media</button>
                <button class="btn btn-workflow" id="downloadWorkflow" style="display: none;">Download ComfyUI Workflow</button>
            </div>
        </div>
    </div>

    <!-- Import the updated script with media support -->
    <script type="module" src="js/script.js"></script>
</body>
</html>